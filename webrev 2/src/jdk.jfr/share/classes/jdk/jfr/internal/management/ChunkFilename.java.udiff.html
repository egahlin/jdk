<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jfr/share/classes/jdk/jfr/internal/management/ChunkFilename.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../jfc/model/JFCModel.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ManagementSupport.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/management/ChunkFilename.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2021, 2023, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2021, 2025, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -23,51 +23,39 @@</span>
   * questions.
   */
  package jdk.jfr.internal.management;
  
  import java.nio.file.Paths;
<span class="udiff-line-added">+ import java.nio.file.Files;</span>
  import java.nio.file.Path;
  import java.time.LocalDateTime;
  import java.io.IOException;
  
<span class="udiff-line-removed">- import jdk.jfr.internal.SecuritySupport;</span>
  import jdk.jfr.internal.util.ValueFormatter;
<span class="udiff-line-removed">- import jdk.jfr.internal.consumer.FileAccess;</span>
  
  // Allows a remote streaming client to create chunk files
  // with same naming scheme as the JVM.
  public final class ChunkFilename {
     private static final int MAX_CHUNK_NAMES = 100_000;
     private static final String FILE_EXTENSION = &quot;.jfr&quot;;
  
     private final Path directory;
<span class="udiff-line-removed">-    private final FileAccess fileAcess;</span>
  
     private Path lastPath;
     private int counter;
  
<span class="udiff-line-modified-removed">-    public static ChunkFilename newUnpriviliged(Path directory) {</span>
<span class="udiff-line-modified-removed">-        return new ChunkFilename(directory, FileAccess.UNPRIVILEGED);</span>
<span class="udiff-line-removed">-    }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-    public static ChunkFilename newPriviliged(Path directory) {</span>
<span class="udiff-line-removed">-        return new ChunkFilename(directory, SecuritySupport.PRIVILEGED);</span>
<span class="udiff-line-removed">-    }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-    private ChunkFilename(Path directory, FileAccess fileAccess) {</span>
<span class="udiff-line-removed">-        // Avoid malicious implementations of Path interface</span>
<span class="udiff-line-removed">-        this.directory = Paths.get(directory.toString());</span>
<span class="udiff-line-removed">-        this.fileAcess = fileAccess;</span>
<span class="udiff-line-modified-added">+    public ChunkFilename(Path directory) {</span>
<span class="udiff-line-modified-added">+        this.directory = directory;</span>
     }
  
     public String next(LocalDateTime time) throws IOException {
         String filename = ValueFormatter.formatDateTime(time);
         Path p = directory.resolve(filename + FILE_EXTENSION);
  
         // If less than one file per second (typically case)
         if (lastPath == null || !p.equals(lastPath)) {
<span class="udiff-line-modified-removed">-            if (!fileAcess.exists(p)) {</span>
<span class="udiff-line-modified-added">+            if (!Files.exists(p)) {</span>
                 counter = 1; // reset counter
                 lastPath = p;
                 return p.toString();
             }
         }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -75,11 +63,11 @@</span>
         // If more than one file per second
         while (counter &lt; MAX_CHUNK_NAMES) {
             String extendedName = makeExtendedName(filename, counter);
             p = directory.resolve(extendedName);
             counter++;
<span class="udiff-line-modified-removed">-            if (!fileAcess.exists(p)) {</span>
<span class="udiff-line-modified-added">+            if (!Files.exists(p)) {</span>
                 return p.toString();
             }
         }
         throw new IOException(&quot;Unable to find unused filename after &quot; + counter + &quot; attempts&quot;);
     }
</pre>
<center><a href="../jfc/model/JFCModel.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="ManagementSupport.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>