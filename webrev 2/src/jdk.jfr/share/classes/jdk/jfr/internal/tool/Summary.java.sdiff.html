<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/internal/tool/Summary.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="Disassemble.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../util/Utils.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/tool/Summary.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2024, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 24  */
 25 
 26 package jdk.jfr.internal.tool;
 27 
 28 import java.io.IOException;
 29 import java.io.PrintStream;
 30 import java.nio.file.Path;
 31 import java.time.Instant;
 32 import java.time.ZoneOffset;
 33 import java.time.format.DateTimeFormatter;
 34 import java.util.ArrayList;
 35 import java.util.Deque;
 36 import java.util.HashMap;
 37 import java.util.List;
 38 import java.util.Locale;
 39 
 40 import jdk.jfr.EventType;
 41 import jdk.jfr.internal.MetadataDescriptor;
 42 import jdk.jfr.internal.Type;
 43 import jdk.jfr.internal.consumer.ChunkHeader;
<span class="line-removed"> 44 import jdk.jfr.internal.consumer.FileAccess;</span>
 45 import jdk.jfr.internal.consumer.RecordingInput;
 46 import jdk.jfr.internal.util.UserDataException;
 47 import jdk.jfr.internal.util.UserSyntaxException;
 48 
 49 final class Summary extends Command {
 50     private final DateTimeFormatter DATE_FORMAT = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;).withLocale(Locale.UK).withZone(ZoneOffset.UTC);
 51 
 52     @Override
 53     public String getName() {
 54         return &quot;summary&quot;;
 55     }
 56 
 57     private static class Statistics {
 58         Statistics(String name) {
 59             this.name = name;
 60         }
 61         String name;
 62         long count;
 63         long size;
 64     }
</pre>
<hr />
<pre>
 76     @Override
 77     public String getDescription() {
 78         return &quot;Display general information about a recording file (.jfr)&quot;;
 79     }
 80 
 81     @Override
 82     public void execute(Deque&lt;String&gt; options) throws UserSyntaxException, UserDataException {
 83         ensureMaxArgumentCount(options, 1);
 84         Path p = getJFRInputFile(options);
 85         try {
 86             printInformation(p);
 87         } catch (IOException e) {
 88             couldNotReadError(p, e);
 89         }
 90     }
 91 
 92     private void printInformation(Path p) throws IOException {
 93         long totalDuration = 0;
 94         long chunks = 0;
 95 
<span class="line-modified"> 96         try (RecordingInput input = new RecordingInput(p.toFile(), FileAccess.UNPRIVILEGED)) {</span>
 97             ChunkHeader first = new ChunkHeader(input);
 98             ChunkHeader ch = first;
 99             String eventPrefix = Type.EVENT_NAME_PREFIX;
100             if (first.getMajor() == 1) {
101                 eventPrefix = &quot;com.oracle.jdk.&quot;;
102             }
103             HashMap&lt;Long, Statistics&gt; stats = new HashMap&lt;&gt;();
104             stats.put(0L, new Statistics(eventPrefix + &quot;Metadata&quot;));
105             stats.put(1L, new Statistics(eventPrefix + &quot;Checkpoint&quot;));
106             int minWidth = 0;
107             while (true) {
108                 long chunkEnd = ch.getEnd();
109                 MetadataDescriptor md = ch.readMetadata();
110 
111                 for (EventType eventType : md.getEventTypes()) {
112                     stats.computeIfAbsent(eventType.getId(), (e) -&gt; new Statistics(eventType.getName()));
113                     minWidth = Math.max(minWidth, eventType.getName().length());
114                 }
115 
116                 totalDuration += ch.getDurationNanos();
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2025, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
</pre>
<hr />
<pre>
 24  */
 25 
 26 package jdk.jfr.internal.tool;
 27 
 28 import java.io.IOException;
 29 import java.io.PrintStream;
 30 import java.nio.file.Path;
 31 import java.time.Instant;
 32 import java.time.ZoneOffset;
 33 import java.time.format.DateTimeFormatter;
 34 import java.util.ArrayList;
 35 import java.util.Deque;
 36 import java.util.HashMap;
 37 import java.util.List;
 38 import java.util.Locale;
 39 
 40 import jdk.jfr.EventType;
 41 import jdk.jfr.internal.MetadataDescriptor;
 42 import jdk.jfr.internal.Type;
 43 import jdk.jfr.internal.consumer.ChunkHeader;

 44 import jdk.jfr.internal.consumer.RecordingInput;
 45 import jdk.jfr.internal.util.UserDataException;
 46 import jdk.jfr.internal.util.UserSyntaxException;
 47 
 48 final class Summary extends Command {
 49     private final DateTimeFormatter DATE_FORMAT = DateTimeFormatter.ofPattern(&quot;yyyy-MM-dd HH:mm:ss&quot;).withLocale(Locale.UK).withZone(ZoneOffset.UTC);
 50 
 51     @Override
 52     public String getName() {
 53         return &quot;summary&quot;;
 54     }
 55 
 56     private static class Statistics {
 57         Statistics(String name) {
 58             this.name = name;
 59         }
 60         String name;
 61         long count;
 62         long size;
 63     }
</pre>
<hr />
<pre>
 75     @Override
 76     public String getDescription() {
 77         return &quot;Display general information about a recording file (.jfr)&quot;;
 78     }
 79 
 80     @Override
 81     public void execute(Deque&lt;String&gt; options) throws UserSyntaxException, UserDataException {
 82         ensureMaxArgumentCount(options, 1);
 83         Path p = getJFRInputFile(options);
 84         try {
 85             printInformation(p);
 86         } catch (IOException e) {
 87             couldNotReadError(p, e);
 88         }
 89     }
 90 
 91     private void printInformation(Path p) throws IOException {
 92         long totalDuration = 0;
 93         long chunks = 0;
 94 
<span class="line-modified"> 95         try (RecordingInput input = new RecordingInput(p.toFile())) {</span>
 96             ChunkHeader first = new ChunkHeader(input);
 97             ChunkHeader ch = first;
 98             String eventPrefix = Type.EVENT_NAME_PREFIX;
 99             if (first.getMajor() == 1) {
100                 eventPrefix = &quot;com.oracle.jdk.&quot;;
101             }
102             HashMap&lt;Long, Statistics&gt; stats = new HashMap&lt;&gt;();
103             stats.put(0L, new Statistics(eventPrefix + &quot;Metadata&quot;));
104             stats.put(1L, new Statistics(eventPrefix + &quot;Checkpoint&quot;));
105             int minWidth = 0;
106             while (true) {
107                 long chunkEnd = ch.getEnd();
108                 MetadataDescriptor md = ch.readMetadata();
109 
110                 for (EventType eventType : md.getEventTypes()) {
111                     stats.computeIfAbsent(eventType.getId(), (e) -&gt; new Statistics(eventType.getName()));
112                     minWidth = Math.max(minWidth, eventType.getName().length());
113                 }
114 
115                 totalDuration += ch.getDurationNanos();
</pre>
</td>
</tr>
</table>
<center><a href="Disassemble.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../util/Utils.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>