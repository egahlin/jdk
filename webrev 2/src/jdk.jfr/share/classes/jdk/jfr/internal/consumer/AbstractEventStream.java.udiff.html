<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.jfr/share/classes/jdk/jfr/internal/consumer/AbstractEventStream.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../TypeLibrary.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="EventDirectoryStream.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/consumer/AbstractEventStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2019, 2024, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2019, 2025, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -24,13 +24,10 @@</span>
   */
  
  package jdk.jfr.internal.consumer;
  
  import java.io.IOException;
<span class="udiff-line-removed">- import java.security.AccessControlContext;</span>
<span class="udiff-line-removed">- import java.security.AccessController;</span>
<span class="udiff-line-removed">- import java.security.PrivilegedAction;</span>
  import java.time.Duration;
  import java.time.Instant;
  import java.util.List;
  import java.util.Objects;
  import java.util.concurrent.CountDownLatch;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -44,33 +41,29 @@</span>
  import jdk.jfr.consumer.MetadataEvent;
  import jdk.jfr.consumer.RecordedEvent;
  import jdk.jfr.internal.LogLevel;
  import jdk.jfr.internal.LogTag;
  import jdk.jfr.internal.Logger;
<span class="udiff-line-removed">- import jdk.jfr.internal.SecuritySupport;</span>
  
  /*
   * Purpose of this class is to simplify the implementation of
   * an event stream.
   */
  public abstract class AbstractEventStream implements EventStream {
      private static final AtomicLong counter = new AtomicLong();
  
      private final CountDownLatch terminated = new CountDownLatch(1);
      private final Runnable flushOperation = () -&gt; dispatcher().runFlushActions();
<span class="udiff-line-removed">-     @SuppressWarnings(&quot;removal&quot;)</span>
<span class="udiff-line-removed">-     private final AccessControlContext accessControllerContext;</span>
      private final StreamConfiguration streamConfiguration = new StreamConfiguration();
      private final List&lt;Configuration&gt; configurations;
      private final ParserState parserState = new ParserState();
      private volatile boolean closeOnComplete = true;
      private Dispatcher dispatcher;
      private boolean daemon = false;
  
  
<span class="udiff-line-modified-removed">-     AbstractEventStream(@SuppressWarnings(&quot;removal&quot;) AccessControlContext acc, List&lt;Configuration&gt; configurations) throws IOException {</span>
<span class="udiff-line-removed">-         this.accessControllerContext = Objects.requireNonNull(acc);</span>
<span class="udiff-line-modified-added">+     AbstractEventStream(List&lt;Configuration&gt; configurations) throws IOException {</span>
          this.configurations = configurations;
      }
  
      @Override
      public abstract void start();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -219,26 +212,25 @@</span>
          return parserState;
      }
  
      public final void startAsync(long startNanos) {
          startInternal(startNanos);
<span class="udiff-line-modified-removed">-         Runnable r = () -&gt; run(accessControllerContext);</span>
<span class="udiff-line-modified-removed">-         Thread thread = SecuritySupport.createThreadWitNoPermissions(nextThreadName(), r);</span>
<span class="udiff-line-modified-removed">-         SecuritySupport.setDaemonThread(thread, daemon);</span>
<span class="udiff-line-modified-added">+         Runnable r = () -&gt; execute();</span>
<span class="udiff-line-modified-added">+         Thread thread = new Thread(r, nextThreadName());</span>
<span class="udiff-line-modified-added">+         thread.setDaemon(daemon);</span>
          thread.start();
      }
  
      public final void start(long startNanos) {
          startInternal(startNanos);
<span class="udiff-line-modified-removed">-         run(accessControllerContext);</span>
<span class="udiff-line-modified-added">+         execute();</span>
      }
  
      protected final Runnable getFlushOperation() {
          return flushOperation;
      }
  
<span class="udiff-line-removed">- </span>
      protected final void onFlush() {
         Runnable r = getFlushOperation();
         if (r != null) {
             r.run();
         }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -274,21 +266,10 @@</span>
                  terminated.countDown();
              }
          }
      }
  
<span class="udiff-line-removed">-     @SuppressWarnings(&quot;removal&quot;)</span>
<span class="udiff-line-removed">-     private void run(AccessControlContext accessControlContext) {</span>
<span class="udiff-line-removed">-         AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() {</span>
<span class="udiff-line-removed">-             @Override</span>
<span class="udiff-line-removed">-             public Void run() {</span>
<span class="udiff-line-removed">-                 execute();</span>
<span class="udiff-line-removed">-                 return null;</span>
<span class="udiff-line-removed">-             }</span>
<span class="udiff-line-removed">-         }, accessControlContext);</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
      private String nextThreadName() {
          return &quot;JFR Event Stream &quot; + counter.incrementAndGet();
      }
  
      @Override
</pre>
<center><a href="../TypeLibrary.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="EventDirectoryStream.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>