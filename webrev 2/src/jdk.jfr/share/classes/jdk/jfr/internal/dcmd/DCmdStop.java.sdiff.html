<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/internal/dcmd/DCmdStop.java</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DCmdStart.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../event/EventWriter.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/internal/dcmd/DCmdStop.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2024, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.jfr.internal.dcmd;
 26 
 27 import java.io.IOException;
 28 import java.nio.file.InvalidPathException;

 29 import java.nio.file.Paths;
 30 
 31 import jdk.jfr.Recording;
 32 import jdk.jfr.internal.PrivateAccess;
<span class="line-modified"> 33 import jdk.jfr.internal.SecuritySupport.SafePath;</span>
<span class="line-removed"> 34 import jdk.jfr.internal.WriteableUserPath;</span>
 35 
 36 /**
 37  * JFR.stop
 38  *
 39  */
 40 // Instantiated by native
 41 final class DCmdStop extends AbstractDCmd {
 42 
 43     @Override
 44     protected void execute(ArgumentParser parser)  throws DCmdException {
 45         parser.checkUnknownArguments();
 46         String name = parser.getOption(&quot;name&quot;);
 47         String filename = parser.getOption(&quot;filename&quot;);
 48         try {
 49             Recording recording = findRecording(name);
<span class="line-modified"> 50             WriteableUserPath path = PrivateAccess.getInstance().getPlatformRecording(recording).getDestination();</span>
<span class="line-modified"> 51             SafePath safePath = path == null ? null : new SafePath(path.getRealPathText());</span>
 52             if (filename != null) {
 53                 try {
<span class="line-modified"> 54                     // Ensure path is valid. Don&#39;t generate safePath if filename == null, as a user may</span>
 55                     // want to stop recording without a dump
<span class="line-modified"> 56                     safePath = resolvePath(null, filename);</span>
 57                     recording.setDestination(Paths.get(filename));
 58                 } catch (IOException | InvalidPathException  e) {
 59                     throw new DCmdException(&quot;Failed to stop %s. Could not set destination for \&quot;%s\&quot; to file %s&quot;, recording.getName(), filename, e.getMessage());
 60                 }
 61             }
 62             recording.stop();
<span class="line-modified"> 63             reportOperationComplete(&quot;Stopped&quot;, recording.getName(), safePath);</span>
 64             recording.close();
 65         } catch (InvalidPathException | DCmdException e) {
 66             if (filename != null) {
 67                 throw new DCmdException(&quot;Could not write recording \&quot;%s\&quot; to file. %s&quot;, name, e.getMessage());
 68             }
 69             throw new DCmdException(e, &quot;Could not stop recording \&quot;%s\&quot;.&quot;, name, e.getMessage());
 70         }
 71     }
 72 
 73     @Override
 74     public String[] getHelp() {
 75             // 0123456789001234567890012345678900123456789001234567890012345678900123456789001234567890
 76         return &quot;&quot;&quot;
 77                Syntax : JFR.stop [options]
 78 
 79                Options:
 80 
 81                  filename  (Optional) Name of the file to which the recording is written when the
 82                            recording is stopped. If no path is provided, the data from the recording
 83                            is discarded. (FILE, no default value)
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2012, 2025, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 package jdk.jfr.internal.dcmd;
 26 
 27 import java.io.IOException;
 28 import java.nio.file.InvalidPathException;
<span class="line-added"> 29 import java.nio.file.Path;</span>
 30 import java.nio.file.Paths;
 31 
 32 import jdk.jfr.Recording;
 33 import jdk.jfr.internal.PrivateAccess;
<span class="line-modified"> 34 import jdk.jfr.internal.WriteablePath;</span>

 35 
 36 /**
 37  * JFR.stop
 38  *
 39  */
 40 // Instantiated by native
 41 final class DCmdStop extends AbstractDCmd {
 42 
 43     @Override
 44     protected void execute(ArgumentParser parser)  throws DCmdException {
 45         parser.checkUnknownArguments();
 46         String name = parser.getOption(&quot;name&quot;);
 47         String filename = parser.getOption(&quot;filename&quot;);
 48         try {
 49             Recording recording = findRecording(name);
<span class="line-modified"> 50             WriteablePath wp = PrivateAccess.getInstance().getPlatformRecording(recording).getDestination();</span>
<span class="line-modified"> 51             Path path = wp == null ? null : wp.getReal();</span>
 52             if (filename != null) {
 53                 try {
<span class="line-modified"> 54                     // Ensure path is valid. Don&#39;t generate path if filename == null, as a user may</span>
 55                     // want to stop recording without a dump
<span class="line-modified"> 56                     path = resolvePath(null, filename);</span>
 57                     recording.setDestination(Paths.get(filename));
 58                 } catch (IOException | InvalidPathException  e) {
 59                     throw new DCmdException(&quot;Failed to stop %s. Could not set destination for \&quot;%s\&quot; to file %s&quot;, recording.getName(), filename, e.getMessage());
 60                 }
 61             }
 62             recording.stop();
<span class="line-modified"> 63             reportOperationComplete(&quot;Stopped&quot;, recording.getName(), path);</span>
 64             recording.close();
 65         } catch (InvalidPathException | DCmdException e) {
 66             if (filename != null) {
 67                 throw new DCmdException(&quot;Could not write recording \&quot;%s\&quot; to file. %s&quot;, name, e.getMessage());
 68             }
 69             throw new DCmdException(e, &quot;Could not stop recording \&quot;%s\&quot;.&quot;, name, e.getMessage());
 70         }
 71     }
 72 
 73     @Override
 74     public String[] getHelp() {
 75             // 0123456789001234567890012345678900123456789001234567890012345678900123456789001234567890
 76         return &quot;&quot;&quot;
 77                Syntax : JFR.stop [options]
 78 
 79                Options:
 80 
 81                  filename  (Optional) Name of the file to which the recording is written when the
 82                            recording is stopped. If no path is provided, the data from the recording
 83                            is discarded. (FILE, no default value)
</pre>
</td>
</tr>
</table>
<center><a href="DCmdStart.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="../event/EventWriter.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>