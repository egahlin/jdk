<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/EventFactory.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="AnnotationElement.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="FlightRecorder.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/EventFactory.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2024, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr;
 27 
 28 import java.lang.invoke.MethodHandle;
 29 import java.lang.invoke.MethodHandles;
 30 import java.util.ArrayList;
 31 import java.util.HashSet;
 32 import java.util.List;
 33 import java.util.Objects;
 34 import java.util.Set;
 35 
 36 import jdk.internal.module.Checks;
 37 import jdk.jfr.internal.EventClassBuilder;
 38 import jdk.jfr.internal.JVMSupport;
 39 import jdk.jfr.internal.MetadataRepository;
<span class="line-removed"> 40 import jdk.jfr.internal.SecuritySupport;</span>
 41 import jdk.jfr.internal.Type;
 42 import jdk.jfr.internal.util.Utils;
 43 
 44 /**
 45  * Class for defining an event at runtime.
 46  * &lt;p&gt;
 47  * It&#39;s highly recommended that the event is defined at compile time, if the
 48  * field layout is known, so the Java Virtual Machine (JVM) can optimize the
 49  * code, possibly remove all instrumentation if Flight Recorder is inactive or
 50  * if the enabled setting for this event is set to {@code false}.
 51  * &lt;p&gt;
 52  * To define an event at compile time, see {@link Event}.
 53  * &lt;p&gt;
 54  * The following example shows how to implement a dynamic {@code Event} class.
 55  *
 56  * {@snippet class=&quot;Snippets&quot; region=&quot;EventFactoryOverview&quot;}
 57  *
 58  * @since 9
 59  */
 60 public final class EventFactory {
</pre>
<hr />
<pre>
 82      * @param annotationElements list of annotation elements that describes the
 83      *        annotations on the event, not {@code null}
 84      *
 85      * @param fields list of descriptors that describes the fields of the event, not
 86      *        {@code null}
 87      *
 88      * @return event factory, not {@code null}
 89      *
 90      * @throws IllegalArgumentException if the input is not valid. For example,
 91      *         input might not be valid if the field type or name is not valid in
 92      *         the Java language or an annotation element references a type that
 93      *         can&#39;t be found.
 94      *
 95      * @see Event#set(int, Object)
 96      */
 97     public static EventFactory create(List&lt;AnnotationElement&gt; annotationElements, List&lt;ValueDescriptor&gt; fields) {
 98         Objects.requireNonNull(annotationElements, &quot;annotationElements&quot;);
 99         Objects.requireNonNull(fields, &quot;fields&quot;);
100         JVMSupport.ensureWithInternalError();
101 
<span class="line-removed">102         SecuritySupport.checkRegisterPermission();</span>
<span class="line-removed">103 </span>
104         List&lt;AnnotationElement&gt; sanitizedAnnotation = Utils.sanitizeNullFreeList(annotationElements, AnnotationElement.class);
105         List&lt;ValueDescriptor&gt; sanitizedFields = Utils.sanitizeNullFreeList(fields, ValueDescriptor.class);
106         Set&lt;String&gt; nameSet = HashSet.newHashSet(sanitizedFields.size());
107         for (ValueDescriptor v : sanitizedFields) {
108             String name = v.getName();
109             if (v.isArray()) {
110                 throw new IllegalArgumentException(&quot;Array types are not allowed for fields&quot;);
111             }
112             if (!Type.isValidJavaFieldType(v.getTypeName())) {
113                 throw new IllegalArgumentException(v.getTypeName() + &quot; is not a valid type for an event field&quot;);
114             }
115             if (!Checks.isJavaIdentifier(v.getName())) {
116                 throw new IllegalArgumentException(name + &quot; is not a valid name for an event field&quot;);
117             }
118             if (nameSet.contains(name)) {
119                 throw new IllegalArgumentException(&quot;Name of fields must be unique. Found two instances of &quot; + name);
120             }
121             nameSet.add(name);
122         }
123 
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2025, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr;
 27 
 28 import java.lang.invoke.MethodHandle;
 29 import java.lang.invoke.MethodHandles;
 30 import java.util.ArrayList;
 31 import java.util.HashSet;
 32 import java.util.List;
 33 import java.util.Objects;
 34 import java.util.Set;
 35 
 36 import jdk.internal.module.Checks;
 37 import jdk.jfr.internal.EventClassBuilder;
 38 import jdk.jfr.internal.JVMSupport;
 39 import jdk.jfr.internal.MetadataRepository;

 40 import jdk.jfr.internal.Type;
 41 import jdk.jfr.internal.util.Utils;
 42 
 43 /**
 44  * Class for defining an event at runtime.
 45  * &lt;p&gt;
 46  * It&#39;s highly recommended that the event is defined at compile time, if the
 47  * field layout is known, so the Java Virtual Machine (JVM) can optimize the
 48  * code, possibly remove all instrumentation if Flight Recorder is inactive or
 49  * if the enabled setting for this event is set to {@code false}.
 50  * &lt;p&gt;
 51  * To define an event at compile time, see {@link Event}.
 52  * &lt;p&gt;
 53  * The following example shows how to implement a dynamic {@code Event} class.
 54  *
 55  * {@snippet class=&quot;Snippets&quot; region=&quot;EventFactoryOverview&quot;}
 56  *
 57  * @since 9
 58  */
 59 public final class EventFactory {
</pre>
<hr />
<pre>
 81      * @param annotationElements list of annotation elements that describes the
 82      *        annotations on the event, not {@code null}
 83      *
 84      * @param fields list of descriptors that describes the fields of the event, not
 85      *        {@code null}
 86      *
 87      * @return event factory, not {@code null}
 88      *
 89      * @throws IllegalArgumentException if the input is not valid. For example,
 90      *         input might not be valid if the field type or name is not valid in
 91      *         the Java language or an annotation element references a type that
 92      *         can&#39;t be found.
 93      *
 94      * @see Event#set(int, Object)
 95      */
 96     public static EventFactory create(List&lt;AnnotationElement&gt; annotationElements, List&lt;ValueDescriptor&gt; fields) {
 97         Objects.requireNonNull(annotationElements, &quot;annotationElements&quot;);
 98         Objects.requireNonNull(fields, &quot;fields&quot;);
 99         JVMSupport.ensureWithInternalError();
100 


101         List&lt;AnnotationElement&gt; sanitizedAnnotation = Utils.sanitizeNullFreeList(annotationElements, AnnotationElement.class);
102         List&lt;ValueDescriptor&gt; sanitizedFields = Utils.sanitizeNullFreeList(fields, ValueDescriptor.class);
103         Set&lt;String&gt; nameSet = HashSet.newHashSet(sanitizedFields.size());
104         for (ValueDescriptor v : sanitizedFields) {
105             String name = v.getName();
106             if (v.isArray()) {
107                 throw new IllegalArgumentException(&quot;Array types are not allowed for fields&quot;);
108             }
109             if (!Type.isValidJavaFieldType(v.getTypeName())) {
110                 throw new IllegalArgumentException(v.getTypeName() + &quot; is not a valid type for an event field&quot;);
111             }
112             if (!Checks.isJavaIdentifier(v.getName())) {
113                 throw new IllegalArgumentException(name + &quot; is not a valid name for an event field&quot;);
114             }
115             if (nameSet.contains(name)) {
116                 throw new IllegalArgumentException(&quot;Name of fields must be unique. Found two instances of &quot; + name);
117             }
118             nameSet.add(name);
119         }
120 
</pre>
</td>
</tr>
</table>
<center><a href="AnnotationElement.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="FlightRecorder.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>