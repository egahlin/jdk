<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/jdk.jfr/share/classes/jdk/jfr/ValueDescriptor.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="SettingControl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="consumer/EventStream.java.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/ValueDescriptor.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2024, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr;
 27 
 28 import java.lang.annotation.Annotation;
 29 import java.util.Collections;
 30 import java.util.List;
 31 import java.util.Objects;
 32 
 33 import jdk.jfr.internal.AnnotationConstruct;
<span class="line-removed"> 34 import jdk.jfr.internal.SecuritySupport;</span>
 35 import jdk.jfr.internal.Type;
 36 import jdk.jfr.internal.util.Utils;
 37 
 38 /**
 39  * Describes the event fields and annotation elements.
 40  * &lt;p&gt;
 41  * The following example shows how the {@code ValueDescriptor} class can
 42  * be used to list field information of all types.
 43  *
 44  * {@snippet class=&quot;Snippets&quot; region=&quot;ValueDescriptorOverview&quot;}
 45  *
 46  * @since 9
 47  */
 48 public final class ValueDescriptor {
 49     private static final String UNKNOWN = new String();
 50     private final AnnotationConstruct annotationConstruct;
 51     private final Type type;
 52     private final String name;
 53     private final boolean isArray;
 54     private final boolean constantPool;
</pre>
<hr />
<pre>
126      * &lt;p&gt;
127      * The name must be a valid Java identifier (for example, {@code &quot;maxThroughput&quot;}). See
128      * section 3.8 and 3.9 of the Java Language Specification for more information.
129      *
130      * @param type the type, not {@code null}
131      * @param name the name, not {@code null}
132      * @param annotations the annotations on the value descriptors, not
133      *        {@code null}
134      *
135      * @throws IllegalArgumentException if the name is not a valid Java identifier
136      */
137     public ValueDescriptor(Class&lt;?&gt; type, String name, List&lt;AnnotationElement&gt; annotations) {
138         this(type, name, List.copyOf(annotations), false);
139     }
140 
141 
142     ValueDescriptor(Class&lt;?&gt; type, String name, List&lt;AnnotationElement&gt; annotations, boolean allowArray) {
143         Objects.requireNonNull(type, &quot;type&quot;);
144         Objects.requireNonNull(name, &quot;name&quot;);
145         Objects.requireNonNull(annotations, &quot;annotations&quot;);
<span class="line-removed">146         SecuritySupport.checkRegisterPermission();</span>
147         if (!allowArray) {
148             if (type.isArray()) {
149                 throw new IllegalArgumentException(&quot;Array types are not allowed&quot;);
150             }
151         }
152         this.name = Objects.requireNonNull(name, &quot;Name of value descriptor can&#39;t be null&quot;);
153         Utils.ensureJavaIdentifier(name);
154         this.type = Objects.requireNonNull(Utils.getValidType(Objects.requireNonNull(type), Objects.requireNonNull(name)));
155         this.annotationConstruct = new AnnotationConstruct(annotations);
156         this.javaFieldName = name; // Needed for dynamic events
157         this.isArray = type.isArray();
158         // Assume we always want to store String and Thread in constant pool
159         this.constantPool = type == Class.class || type == Thread.class;
160     }
161 
162     /**
163      * Returns a human-readable name that describes the value (for example,
164      * {@code &quot;Maximum Throughput&quot;}).
165      *
166      * @return a human-readable name, or {@code null} if doesn&#39;t exist
</pre>
</td>
<td>
<hr />
<pre>
  1 /*
<span class="line-modified">  2  * Copyright (c) 2016, 2025, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
 26 package jdk.jfr;
 27 
 28 import java.lang.annotation.Annotation;
 29 import java.util.Collections;
 30 import java.util.List;
 31 import java.util.Objects;
 32 
 33 import jdk.jfr.internal.AnnotationConstruct;

 34 import jdk.jfr.internal.Type;
 35 import jdk.jfr.internal.util.Utils;
 36 
 37 /**
 38  * Describes the event fields and annotation elements.
 39  * &lt;p&gt;
 40  * The following example shows how the {@code ValueDescriptor} class can
 41  * be used to list field information of all types.
 42  *
 43  * {@snippet class=&quot;Snippets&quot; region=&quot;ValueDescriptorOverview&quot;}
 44  *
 45  * @since 9
 46  */
 47 public final class ValueDescriptor {
 48     private static final String UNKNOWN = new String();
 49     private final AnnotationConstruct annotationConstruct;
 50     private final Type type;
 51     private final String name;
 52     private final boolean isArray;
 53     private final boolean constantPool;
</pre>
<hr />
<pre>
125      * &lt;p&gt;
126      * The name must be a valid Java identifier (for example, {@code &quot;maxThroughput&quot;}). See
127      * section 3.8 and 3.9 of the Java Language Specification for more information.
128      *
129      * @param type the type, not {@code null}
130      * @param name the name, not {@code null}
131      * @param annotations the annotations on the value descriptors, not
132      *        {@code null}
133      *
134      * @throws IllegalArgumentException if the name is not a valid Java identifier
135      */
136     public ValueDescriptor(Class&lt;?&gt; type, String name, List&lt;AnnotationElement&gt; annotations) {
137         this(type, name, List.copyOf(annotations), false);
138     }
139 
140 
141     ValueDescriptor(Class&lt;?&gt; type, String name, List&lt;AnnotationElement&gt; annotations, boolean allowArray) {
142         Objects.requireNonNull(type, &quot;type&quot;);
143         Objects.requireNonNull(name, &quot;name&quot;);
144         Objects.requireNonNull(annotations, &quot;annotations&quot;);

145         if (!allowArray) {
146             if (type.isArray()) {
147                 throw new IllegalArgumentException(&quot;Array types are not allowed&quot;);
148             }
149         }
150         this.name = Objects.requireNonNull(name, &quot;Name of value descriptor can&#39;t be null&quot;);
151         Utils.ensureJavaIdentifier(name);
152         this.type = Objects.requireNonNull(Utils.getValidType(Objects.requireNonNull(type), Objects.requireNonNull(name)));
153         this.annotationConstruct = new AnnotationConstruct(annotations);
154         this.javaFieldName = name; // Needed for dynamic events
155         this.isArray = type.isArray();
156         // Assume we always want to store String and Thread in constant pool
157         this.constantPool = type == Class.class || type == Thread.class;
158     }
159 
160     /**
161      * Returns a human-readable name that describes the value (for example,
162      * {@code &quot;Maximum Throughput&quot;}).
163      *
164      * @return a human-readable name, or {@code null} if doesn&#39;t exist
</pre>
</td>
</tr>
</table>
<center><a href="SettingControl.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="consumer/EventStream.java.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>