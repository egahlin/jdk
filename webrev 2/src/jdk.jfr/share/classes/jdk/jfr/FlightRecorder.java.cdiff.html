<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/jdk.jfr/share/classes/jdk/jfr/FlightRecorder.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
  </head>
<body>
<center><a href="EventFactory.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="FlightRecorderPermission.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.jfr/share/classes/jdk/jfr/FlightRecorder.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 1,7 ***</span>
  /*
<span class="line-modified">!  * Copyright (c) 2016, 2024, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
<span class="line-new-header">--- 1,7 ---</span>
  /*
<span class="line-modified">!  * Copyright (c) 2016, 2025, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-old-header">*** 27,12 ***</span>
  
  import static jdk.jfr.internal.LogLevel.DEBUG;
  import static jdk.jfr.internal.LogLevel.INFO;
  import static jdk.jfr.internal.LogTag.JFR;
  
<span class="line-removed">- import java.security.AccessControlContext;</span>
<span class="line-removed">- import java.security.AccessController;</span>
  import java.util.ArrayList;
  import java.util.Collections;
  import java.util.List;
  import java.util.Objects;
  
<span class="line-new-header">--- 27,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 42,11 ***</span>
  import jdk.jfr.internal.MetadataRepository;
  import jdk.jfr.internal.Options;
  import jdk.jfr.internal.PlatformRecorder;
  import jdk.jfr.internal.PlatformRecording;
  import jdk.jfr.internal.Repository;
<span class="line-removed">- import jdk.jfr.internal.SecuritySupport;</span>
  import jdk.jfr.internal.util.Utils;
  import jdk.jfr.internal.periodic.PeriodicEvents;
  
  /**
   * Class for accessing, controlling, and managing Flight Recorder.
<span class="line-new-header">--- 40,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 155,11 ***</span>
       *         example, if the Java Virtual Machine (JVM) lacks Flight Recorder
       *         support, or if the file repository can&#39;t be created or accessed)
       */
      public static FlightRecorder getFlightRecorder() throws IllegalStateException {
          synchronized (PlatformRecorder.class) {
<span class="line-removed">-             SecuritySupport.checkAccessFlightRecorder();</span>
              JVMSupport.ensureWithIllegalStateException();
              if (platformRecorder == null) {
                  try {
                      platformRecorder = new FlightRecorder(new PlatformRecorder());
                  } catch (IllegalStateException ise) {
<span class="line-new-header">--- 152,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 211,25 ***</span>
          if (JVMSupport.isNotAvailable()) {
              return;
          }
  
          Utils.ensureValidEventSubclass(eventClass);
<span class="line-modified">!         SecuritySupport.checkRegisterPermission();</span>
<span class="line-removed">-         @SuppressWarnings(&quot;removal&quot;)</span>
<span class="line-removed">-         AccessControlContext acc = AccessController.getContext();</span>
<span class="line-removed">-         PeriodicEvents.addUserEvent(acc, eventClass, hook);</span>
      }
  
      /**
       * Removes a hook for a periodic event.
       *
       * @param hook the hook to remove, not {@code null}
       * @return {@code true} if hook is removed, {@code false} otherwise
       */
      public static boolean removePeriodicEvent(Runnable hook) {
          Objects.requireNonNull(hook, &quot;hook&quot;);
<span class="line-removed">-         SecuritySupport.checkRegisterPermission();</span>
          if (JVMSupport.isNotAvailable()) {
              return false;
          }
          return PeriodicEvents.removeEvent(hook);
      }
<span class="line-new-header">--- 207,21 ---</span>
          if (JVMSupport.isNotAvailable()) {
              return;
          }
  
          Utils.ensureValidEventSubclass(eventClass);
<span class="line-modified">!         PeriodicEvents.addJavaEvent(eventClass, hook);</span>
      }
  
      /**
       * Removes a hook for a periodic event.
       *
       * @param hook the hook to remove, not {@code null}
       * @return {@code true} if hook is removed, {@code false} otherwise
       */
      public static boolean removePeriodicEvent(Runnable hook) {
          Objects.requireNonNull(hook, &quot;hook&quot;);
          if (JVMSupport.isNotAvailable()) {
              return false;
          }
          return PeriodicEvents.removeEvent(hook);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 247,22 ***</span>
      public List&lt;EventType&gt; getEventTypes() {
          return Collections.unmodifiableList(MetadataRepository.getInstance().getRegisteredEventTypes());
      }
  
      /**
<span class="line-modified">!      * Adds a recorder listener and captures the {@code AccessControlContext} to</span>
<span class="line-removed">-      * use when invoking the listener.</span>
       * &lt;p&gt;
       * If Flight Recorder is already initialized when the listener is added, then the method
       * {@link FlightRecorderListener#recorderInitialized(FlightRecorder)} method is
       * invoked before returning from this method.
       *
       * @param changeListener the listener to add, not {@code null}
       */
      public static void addListener(FlightRecorderListener changeListener) {
          Objects.requireNonNull(changeListener, &quot;changeListener&quot;);
<span class="line-removed">-         SecuritySupport.checkAccessFlightRecorder();</span>
          if (JVMSupport.isNotAvailable()) {
              return;
          }
          PlatformRecorder.addListener(changeListener);
      }
<span class="line-new-header">--- 239,20 ---</span>
      public List&lt;EventType&gt; getEventTypes() {
          return Collections.unmodifiableList(MetadataRepository.getInstance().getRegisteredEventTypes());
      }
  
      /**
<span class="line-modified">!      * Adds a recorder listener.</span>
       * &lt;p&gt;
       * If Flight Recorder is already initialized when the listener is added, then the method
       * {@link FlightRecorderListener#recorderInitialized(FlightRecorder)} method is
       * invoked before returning from this method.
       *
       * @param changeListener the listener to add, not {@code null}
       */
      public static void addListener(FlightRecorderListener changeListener) {
          Objects.requireNonNull(changeListener, &quot;changeListener&quot;);
          if (JVMSupport.isNotAvailable()) {
              return;
          }
          PlatformRecorder.addListener(changeListener);
      }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 278,11 ***</span>
       * @return {@code true}, if the listener could be removed, {@code false}
       *         otherwise
       */
      public static boolean removeListener(FlightRecorderListener changeListener) {
          Objects.requireNonNull(changeListener, &quot;changeListener&quot;);
<span class="line-removed">-         SecuritySupport.checkAccessFlightRecorder();</span>
          if (JVMSupport.isNotAvailable()) {
              return false;
          }
  
          return PlatformRecorder.removeListener(changeListener);
<span class="line-new-header">--- 268,10 ---</span>
</pre>
<center><a href="EventFactory.java.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../index.html" target="_top">index</a> <a href="FlightRecorderPermission.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>