<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff src/jdk.management.jfr/share/classes/jdk/management/jfr/RemoteRecordingStream.java</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="MBeanUtils.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/jdk/jdk/jfr/jcmd/TestJcmdConfigure.java.udiff.html" target="_top">next &gt;</a></center>    <h2>src/jdk.management.jfr/share/classes/jdk/management/jfr/RemoteRecordingStream.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,7 @@</span>
  /*
<span class="udiff-line-modified-removed">-  * Copyright (c) 2020, 2024, Oracle and/or its affiliates. All rights reserved.</span>
<span class="udiff-line-modified-added">+  * Copyright (c) 2020, 2025, Oracle and/or its affiliates. All rights reserved.</span>
   * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   *
   * This code is free software; you can redistribute it and/or modify it
   * under the terms of the GNU General Public License version 2 only, as
   * published by the Free Software Foundation.  Oracle designates this
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -30,23 +30,20 @@</span>
  import java.nio.channels.FileChannel;
  import java.nio.file.Files;
  import java.nio.file.Path;
  import java.nio.file.Paths;
  import java.nio.file.StandardOpenOption;
<span class="udiff-line-removed">- import java.security.AccessControlContext;</span>
<span class="udiff-line-removed">- import java.security.AccessController;</span>
  import java.time.Duration;
  import java.time.Instant;
  import java.util.ArrayList;
  import java.util.Collections;
  import java.util.HashMap;
  import java.util.List;
  import java.util.Map;
  import java.util.Objects;
  import java.util.concurrent.Future;
  import java.util.function.Consumer;
<span class="udiff-line-removed">- import java.security.AccessControlException;</span>
  import javax.management.JMX;
  import javax.management.MBeanServerConnection;
  import javax.management.ObjectName;
  
  import jdk.jfr.Configuration;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -147,12 +144,10 @@</span>
  
      final Path path;
      final FlightRecorderMXBean mbean;
      final long recordingId;
      final EventStream stream;
<span class="udiff-line-removed">-     @SuppressWarnings(&quot;removal&quot;)</span>
<span class="udiff-line-removed">-     final AccessControlContext accessControllerContext;</span>
      final DiskRepository repository;
      final Instant creationTime;
      final Object lock = new Object();
      volatile Instant startTime;
      volatile Instant endTime;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -203,13 +198,11 @@</span>
  
      @SuppressWarnings(&quot;removal&quot;)
      private RemoteRecordingStream(MBeanServerConnection connection, Path directory, boolean delete) throws IOException {
          Objects.requireNonNull(connection, &quot;connection&quot;);
          Objects.requireNonNull(directory, &quot;directory&quot;);
<span class="udiff-line-modified-removed">-         accessControllerContext = AccessController.getContext();</span>
<span class="udiff-line-removed">-         // Make sure users can&#39;t implement malicious version of a Path object.</span>
<span class="udiff-line-removed">-         path = Paths.get(directory.toString());</span>
<span class="udiff-line-modified-added">+         path = directory;</span>
          if (!Files.exists(path)) {
              throw new IOException(&quot;Download directory doesn&#39;t exist&quot;);
          }
  
          if (!Files.isDirectory(path)) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -217,11 +210,11 @@</span>
          }
          checkFileAccess(path);
          creationTime = Instant.now();
          mbean = createProxy(connection);
          recordingId = createRecording();
<span class="udiff-line-modified-removed">-         stream = ManagementSupport.newEventDirectoryStream(accessControllerContext, path, configurations(mbean));</span>
<span class="udiff-line-modified-added">+         stream = ManagementSupport.newEventDirectoryStream(path, configurations(mbean));</span>
          stream.setStartTime(Instant.MIN);
          repository = new DiskRepository(path, delete);
          ManagementSupport.setOnChunkCompleteHandler(stream, new ChunkConsumer(repository));
      }
  
</pre>
<center><a href="MBeanUtils.java.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="../../../../../../../test/jdk/jdk/jfr/jcmd/TestJcmdConfigure.java.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>