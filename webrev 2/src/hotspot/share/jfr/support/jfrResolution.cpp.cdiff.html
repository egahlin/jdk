<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff src/hotspot/share/jfr/support/jfrResolution.cpp</title>
    <link rel="stylesheet" href="../../../../../style.css" />
  </head>
<body>
<center><a href="jfrIntrinsics.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.jfr/share/classes/jdk/jfr/AnnotationElement.java.cdiff.html" target="_top">next &gt;</a></center>    <h2>src/hotspot/share/jfr/support/jfrResolution.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 180,11 ***</span>
    }
    const vframeStream ljf(jt, true, false);
    return ljf.method();
  }
  
<span class="line-modified">! static const char* const link_error_msg = &quot;illegal access linking method &#39;jdk.jfr.internal.event.EventWriterFactory.getEventWriter(long)&#39;&quot;;</span>
  
  void JfrResolution::on_runtime_resolution(const CallInfo &amp; info, TRAPS) {
    assert(info.selected_method() != nullptr, &quot;invariant&quot;);
    assert(info.resolved_klass() != nullptr, &quot;invariant&quot;);
    static const Symbol* const event_writer_method_name = vmSymbols::getEventWriter_name();
<span class="line-new-header">--- 180,11 ---</span>
    }
    const vframeStream ljf(jt, true, false);
    return ljf.method();
  }
  
<span class="line-modified">! static const char* const link_error_msg = &quot;illegal access linking method &#39;jdk.jfr.internal.event.EventWriter.getEventWriter()&#39;&quot;;</span>
  
  void JfrResolution::on_runtime_resolution(const CallInfo &amp; info, TRAPS) {
    assert(info.selected_method() != nullptr, &quot;invariant&quot;);
    assert(info.resolved_klass() != nullptr, &quot;invariant&quot;);
    static const Symbol* const event_writer_method_name = vmSymbols::getEventWriter_name();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 197,16 ***</span>
    }
    // Fast path
    if (method-&gt;name() != event_writer_method_name) {
      return;
    }
<span class="line-modified">!   static const Symbol* const event_writer_factory_klass_name = vmSymbols::jdk_jfr_internal_event_EventWriterFactory();</span>
<span class="line-modified">!   assert(event_writer_factory_klass_name != nullptr, &quot;invariant&quot;);</span>
<span class="line-modified">!   if (info.resolved_klass()-&gt;name() != event_writer_factory_klass_name) {</span>
      return;
    }
<span class="line-modified">!   // Attempting to link against jdk.jfr.internal.event.EventWriterFactory.getEventWriter().</span>
    // The sender, i.e. the method attempting to link, is in the ljf (if one exists).
    const Method* const sender = ljf_sender_method(THREAD);
    if (sender == nullptr) {
      // A compiler thread is doing linktime resolution but there is no information about the sender available.
      // For the compiler threads, the sender is instead found as part of bytecode parsing.
<span class="line-new-header">--- 197,16 ---</span>
    }
    // Fast path
    if (method-&gt;name() != event_writer_method_name) {
      return;
    }
<span class="line-modified">!   static const Symbol* const event_writer_klass_name = vmSymbols::jdk_jfr_internal_event_EventWriter();</span>
<span class="line-modified">!   assert(event_writer_klass_name != nullptr, &quot;invariant&quot;);</span>
<span class="line-modified">!   if (info.resolved_klass()-&gt;name() != event_writer_klass_name) {</span>
      return;
    }
<span class="line-modified">!   // Attempting to link against jdk.jfr.internal.event.EventWriter.getEventWriter().</span>
    // The sender, i.e. the method attempting to link, is in the ljf (if one exists).
    const Method* const sender = ljf_sender_method(THREAD);
    if (sender == nullptr) {
      // A compiler thread is doing linktime resolution but there is no information about the sender available.
      // For the compiler threads, the sender is instead found as part of bytecode parsing.
</pre>
<hr />
<pre>
<span class="line-old-header">*** 226,13 ***</span>
  #endif
    THROW_MSG(vmSymbols::java_lang_IllegalAccessError(), link_error_msg);
  }
  
  static inline bool is_compiler_linking_event_writer(const Symbol* holder, const Symbol* name) {
<span class="line-modified">!   static const Symbol* const event_writer_factory_klass_name = vmSymbols::jdk_jfr_internal_event_EventWriterFactory();</span>
<span class="line-modified">!   assert(event_writer_factory_klass_name != nullptr, &quot;invariant&quot;);</span>
<span class="line-modified">!   if (holder != event_writer_factory_klass_name) {</span>
      return false;
    }
    static const Symbol* const event_writer_method_name = vmSymbols::getEventWriter_name();
    assert(event_writer_method_name != nullptr, &quot;invariant&quot;);
    return name == event_writer_method_name;
<span class="line-new-header">--- 226,13 ---</span>
  #endif
    THROW_MSG(vmSymbols::java_lang_IllegalAccessError(), link_error_msg);
  }
  
  static inline bool is_compiler_linking_event_writer(const Symbol* holder, const Symbol* name) {
<span class="line-modified">!   static const Symbol* const event_writer_klass_name = vmSymbols::jdk_jfr_internal_event_EventWriter();</span>
<span class="line-modified">!   assert(event_writer_klass_name != nullptr, &quot;invariant&quot;);</span>
<span class="line-modified">!   if (holder != event_writer_klass_name) {</span>
      return false;
    }
    static const Symbol* const event_writer_method_name = vmSymbols::getEventWriter_name();
    assert(event_writer_method_name != nullptr, &quot;invariant&quot;);
    return name == event_writer_method_name;
</pre>
<center><a href="jfrIntrinsics.hpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../index.html" target="_top">index</a> <a href="../../../../jdk.jfr/share/classes/jdk/jfr/AnnotationElement.java.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>